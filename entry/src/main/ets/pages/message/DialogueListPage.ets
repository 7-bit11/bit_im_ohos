import Dialogue, { MessageType, RoleType } from '../../entity/Dialogue';
import router from '@ohos.router';

@Entry
@Component
struct DialogueListPage {
  scroller: Scroller = new Scroller()
  @State name: string = "";
  params: object = router.getParams();

  aboutToAppear(): void {
    this.name = this.params['name'];
  }

  dialogueList: Array<Dialogue> = [
    new Dialogue(MessageType.text,
      '‰Ω†Âú®Â≠¶‰ªÄ‰πàÂïä‰Ω†Âú®Â≠¶‰ªÄ‰πàÂïä‰Ω†Âú®Â≠¶‰ªÄ‰πàÂïä‰Ω†Âú®Â≠¶‰ªÄ‰πàÂïä‰Ω†Âú®Â≠¶‰ªÄ‰πàÂïä‰Ω†Âú®Â≠¶‰ªÄ‰πàÂïä‰Ω†Âú®Â≠¶‰ªÄ‰πàÂïä‰Ω†Âú®Â≠¶‰ªÄ‰πàÂïä',
      "7_bit | [Uint8List] | Â§±Áú†Áóá",
      'https://p3-passport.byteacctimg.com/img/user-avatar/314da9adcd6dacacb8ea4a18c89639ea~140x140.awebp',
      RoleType.me),
    new Dialogue(MessageType.text, 'ÊúâÊ≤°ÊúâÂèØËÉΩËÄÅ‰ΩôÁúãÂà∞‰∫Ü„ÄÇËÆ©‰øÆÂ§ç‰∫Ü',
      "Ê≥ïÁöÑÁ©∫Èó¥ | ‰∏äÊµ∑ | Flutter",
      'https://upload.jianshu.io/users/upload_avatars/15266155/f1956eee-3f4e-4160-a1e5-8460802e518e.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/144/h/144/format/webp',
      RoleType.you),
    new Dialogue(MessageType.text, 'Flutter CTO 2024 Êä•ÂëäÂá∫ÁÇâËß£ËØªÔºåÁúãÁúãÊúâÊ≤°Êúâ‰Ω†ÂÖ≥ÂøÉÁöÑÈóÆÈ¢ò',
      "ÊÅãÁå´deÂ∞èÈÉ≠",
      'https://p3-passport.byteacctimg.com/img/user-avatar/4f40c8c1bc9e95d86779e105c922ca2f~150x150.awebp',
      RoleType.you),
    new Dialogue(MessageType.text, 'ÂõΩÂ∫ÜÂÅáÊúüÔºåÊàëÁî®FlutterÂÜô‰∫Ü‰∏™ÊàëËá™Â∑±ÈÉΩÁé©‰∏çËµ¢ÁöÑ‰∫îÂ≠êÊ£ãAIü§£',
      "ÁºñÁ®ãÁöÑÂ∞èÁôΩ",
      'https://p9-passport.byteacctimg.com/img/user-avatar/af5f7ee5f0c449f25fc0b32c050bf100~150x150.awebp',
      RoleType.you),
    new Dialogue(MessageType.text, 'ÈªëÂÆ£‰πüÊòØÂÆ£',
      "Á≥ñÊûúÂ∞èËúú | ‰∏äÊµ∑ | Â∞ëÂ•≥ÊäòÂØø‰∏≠...",
      'https://pica.zhimg.com/v2-5bd8c44a289103540423859570c878d9_xl.jpg?source=32738c0c',
      RoleType.you),
    new Dialogue(MessageType.image,
      'https://konachan.net/sample/2c00cdddf9ee0da9c34dd7934e49b16c/Konachan.com%20-%20380411%20sample.jpg',
      "7_bit | [Uint8List] | Â§±Áú†Áóá",
      'https://p3-passport.byteacctimg.com/img/user-avatar/314da9adcd6dacacb8ea4a18c89639ea~140x140.awebp',
      RoleType.me),
    new Dialogue(MessageType.text, 'FlutterÂºÄÂèë',
      "Ê±óÁÇíÁÅ∞",
      'https://p6-passport.byteacctimg.com/img/user-avatar/7dcd75f8bfddf5f769e353823694cd5c~70x70.awebp',
      RoleType.you),
    new Dialogue(MessageType.text,
      'È∏øËíônext È´ò‰ªøQQÈ¶ñÈ°µ Âø´Êù•ÁúãÁúãÊàëÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÁöÑÂêßÔºÅ',
      "7_bit | [Uint8List] | Â§±Áú†Áóá",
      'https://p3-passport.byteacctimg.com/img/user-avatar/314da9adcd6dacacb8ea4a18c89639ea~140x140.awebp',
      RoleType.me),
  ];

  build() {
    Column() {
      this.buildAppbar()
      List({ space: 20, scroller: this.scroller }) {
        ForEach(this.dialogueList, (item: Dialogue, index: number) => {
          ListItem() {
            if (item.roleType == RoleType.me) {
              this.meItem(item)
            } else {
              this.youItem(item)
            }
          }
        })
      }.layoutWeight(1).backgroundColor("#f1f1f1")
      .padding(10)
      .scrollBar(BarState.Off)
      this.buildBottomBar()
    }.width("100%").height("100%")
  }

  @Builder
  buildAppbar() {
    Row({ space: 20 }) {
      Image($rawfile("Chevron_Left.svg")).width(24).height(24).fillColor(Color.Black).onClick(() => {
        router.back()
      })

      Text(this.name + "üç¨").fontSize(18)
        .onClick(() => {
          this.scroller.scrollToIndex(this.dialogueList.length - 1, true);
        })
      Blank()
      Image($rawfile("Hamburger_MD.svg")).width(24).height(24).fillColor(Color.Black)
    }
    .width("100%")
    .backgroundColor(Color.White)
    .padding({
      left: 15,
      right: 15,
      top: 10,
      bottom: 10
    })
  }

  @Builder
  buildBottomBar() {
    Row({ space: 10 }) {
      Image($rawfile("microphone.svg")).width(24).height(24).fillColor(Color.Black)
      TextInput()
        .width('95%')
        .height(35)
        .margin(5)
        .maxLength(9)
        .onSecurityStateChange(((isShowPassword: boolean) => {
          // Êõ¥Êñ∞ÂØÜÁ†ÅÊòæÁ§∫Áä∂ÊÄÅ
          console.info('isShowPassword', isShowPassword)

        }))
        .layoutWeight(1)
        .borderRadius(8)
      Image($rawfile("Star-Struck.svg")).width(24).height(24).fillColor(Color.Black)
      Image($rawfile("Add_Plus_Circle.svg")).width(24).height(24).fillColor(Color.Black)
    }
    .padding({
      left: 15,
      right: 15,
      top: 5,
      bottom: 5
    })
  }

  @Builder
  meItem(item: Dialogue) {
    Column({ space: 5 }) {
      Text(item.name).fontSize(12)
      Row() {
        Flex({
          wrap: FlexWrap.WrapReverse,
          direction: FlexDirection.Row,
          justifyContent: FlexAlign.Start,
          alignItems: ItemAlign.Start
        }) {
          if (item.msgType == MessageType.text) {
            Text(item.msg).backgroundColor("#0099ff")
              .padding({
                left: 12,
                right: 12,
                top: 10,
                bottom: 10
              }).fontColor(Color.White)
              .borderRadius(8)
          } else if (item.msgType == MessageType.image) {
            Image(item.msg)
              .objectFit(ImageFit.Auto)
              .alt($rawfile("img.png"))
              .width("70%")
          }
        }.layoutWeight(1)

        Text().width(5)
        Image(item.url).width(40).height(40).borderRadius(30)

      }.alignItems(VerticalAlign.Top)
      .justifyContent(FlexAlign.End)
      .width("90%")

    }
    .justifyContent(FlexAlign.End)
    .alignItems(HorizontalAlign.End)
    .width("100%")
  }

  @Builder
  youItem(item: Dialogue) {
    Column({ space: 5 }) {
      Text(item.name).fontSize(12)
      Row() {
        Image(item.url).width(40).height(40).borderRadius(30)
        Text().width(5)
        Flex({
          wrap: FlexWrap.WrapReverse,
          direction: FlexDirection.Row,
          justifyContent: FlexAlign.End,
          alignItems: ItemAlign.End
        }) {
          if (item.msgType == MessageType.text) {
            Text(item.msg).backgroundColor(Color.White)
              .padding({
                left: 12,
                right: 12,
                top: 10,
                bottom: 10
              }).fontColor(Color.Black)
              .borderRadius(8)
          } else if (item.msgType == MessageType.image) {
            Image(item.msg)
              .objectFit(ImageFit.Auto)
              .alt($rawfile("img.png"))
              .width("70%")
          }
        }.layoutWeight(1)
      }.alignItems(VerticalAlign.Top)
      .justifyContent(FlexAlign.SpaceBetween)
      .width("90%")
    }
    .justifyContent(FlexAlign.Start)
    .alignItems(HorizontalAlign.Start)
  }
}